<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ù…ØªØ¬Ø± Ø§Ù„Ø£Ù†Ø§Ù‚Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
            --primary-color: #143ae6;
            --primary-dark: #764ba2;
            --secondary-color: #f093fb;
            --accent-color: #4facfe;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ */
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-accent: #f3f4f6;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø© */
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
            
            /* Ø§Ù„Ø¸Ù„Ø§Ù„ */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            --border-radius: 0.5rem;
            --border-radius-lg: 0.75rem;
            --border-color: #e5e7eb;
        }

        body {
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }
        
        .order-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-processing {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .status-shipped {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-delivered {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-cancelled {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            transition: all 0.3s ease;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
        }
        
        .modal {
            backdrop-filter: blur(5px);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .new-order {
            animation: slideInRight 0.5s ease-out;
            border-left: 4px solid #10b981;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Admin login modal (client-side protection) -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h2 class="text-xl font-bold mb-4">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
            <p class="text-sm text-gray-600 mb-4">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</p>
            <div class="mb-4">
                <input id="adminPasswordInput" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full px-3 py-2 border rounded-lg" />
            </div>
            <div class="flex justify-end items-center space-x-2 space-x-reverse">
                <button onclick="attemptLogin()" class="px-4 py-2 btn-primary text-white">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            </div>
            <p id="loginError" class="text-red-500 text-sm mt-3 hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.</p>
        </div>
    </div>
    <!-- Header -->
    <header class="sticky top-0 z-50" style="background-color: var(--bg-primary); box-shadow: var(--shadow-lg);">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <h1 class="text-2xl font-bold" style="color: var(--primary-color);">ğŸ“Š Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
                    <div id="newOrderAlert" class="hidden bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold animate-pulse">
                        Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯! ğŸ””
                    </div>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="text-sm text-gray-600">
                        <span>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: </span>
                        <span id="lastUpdate" class="font-semibold">Ø§Ù„Ø¢Ù†</span>
                    </div>
                    <button onclick="refreshOrders()" class="p-2 text-gray-600 hover:text-purple-600 transition-colors" title="ØªØ­Ø¯ÙŠØ«">
                        ğŸ”„
                    </button>
                    <button onclick="exportOrders()" class="p-2 text-gray-600 hover:text-purple-600 transition-colors" title="ØªØµØ¯ÙŠØ±">
                        ğŸ“¥
                    </button>
                    <!-- Link to public store page -->
                    <a href="modir.html" target="_blank" class="ml-2 px-3 py-2 btn-primary text-white rounded-lg text-sm" title="Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±">Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± ğŸ›ï¸</a>
                    <button id="logoutBtn" onclick="logoutAdmin()" class="ml-2 px-3 py-2 bg-red-500 text-white rounded-lg text-sm hidden" title="ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Dashboard -->
    <section class="py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Orders -->
                <div class="stats-card p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                            <p id="totalOrders" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="text-4xl opacity-80">ğŸ“¦</div>
                    </div>
                </div>
                
                <!-- Pending Orders -->
                <div class="bg-yellow-500 text-white p-6 rounded-lg shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                            <p id="pendingOrders" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="text-4xl opacity-80">â³</div>
                    </div>
                </div>
                
                <!-- Total Revenue -->
                <div class="bg-green-500 text-white p-6 rounded-lg shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
                            <p id="totalRevenue" class="text-3xl font-bold">0 Ø±ÙŠØ§Ù„</p>
                        </div>
                        <div class="text-4xl opacity-80">ğŸ’°</div>
                    </div>
                </div>
                
                <!-- Today's Orders -->
                <div class="bg-blue-500 text-white p-6 rounded-lg shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white/80 text-sm">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                            <p id="todayOrders" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="text-4xl opacity-80">ğŸ“…</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters and Search -->
    <section class="py-4">
        <div class="container mx-auto px-4">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø­Ø«</label>
                        <input type="text" id="searchInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..." 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500"
                               onkeyup="filterOrders()">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</label>
                        <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" onchange="filterOrders()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="pending">Ù…Ø¹Ù„Ù‚</option>
                            <option value="processing">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="shipped">ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                            <option value="delivered">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                            <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="dateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" onchange="filterOrders()">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="dateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" onchange="filterOrders()">
                    </div>
                </div>
                
                <div class="flex justify-between items-center mt-4">
                    <button onclick="clearFilters()" class="text-gray-600 hover:text-gray-800 text-sm">
                        Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
                    </button>
                    <div class="text-sm text-gray-600">
                        Ø¹Ø±Ø¶ <span id="filteredCount">0</span> Ù…Ù† <span id="totalCount">0</span> Ø·Ù„Ø¨
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Orders List -->
    <section class="py-4">
        <div class="container mx-auto px-4">
            <div id="ordersContainer" class="space-y-4">
                <!-- Orders will be loaded here -->
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 hidden">
                <div class="text-6xl mb-4">ğŸ“­</div>
                <h3 class="text-xl font-bold text-gray-600 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
                <p class="text-gray-500">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
            </div>
        </div>
    </section>

    <!-- Order Details Modal -->
    <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
                <button onclick="hideOrderDetails()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div id="orderDetailsContent">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Status Update Modal -->
    <div id="statusModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                <button onclick="hideStatusModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="statusForm" onsubmit="updateOrderStatus(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <select id="newStatus" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                        <option value="pending">Ù…Ø¹Ù„Ù‚</option>
                        <option value="processing">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                        <option value="shipped">ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                        <option value="delivered">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                        <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                    </select>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <textarea id="statusNotes" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©..."></textarea>
                </div>
                
                <div class="flex justify-end space-x-4 space-x-reverse">
                    <button type="button" onclick="hideStatusModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="px-4 py-2 text-white btn-primary">
                        ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Notification -->
    <div id="notification" class="fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
        <div class="flex items-center">
            <span class="text-xl ml-2">âœ…</span>
            <span id="notificationText">ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!</span>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© (Ù†Ù…Ø§Ø°Ø¬ Ù„Ù„Ø¹Ø±Ø¶)
        let sampleOrders = [
            {
                id: 'ORD-001',
                customerName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                customerPhone: '+966501234567',
                customerAddress: 'Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø­ÙŠ Ø§Ù„Ù†Ø®ÙŠÙ„ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯',
                items: [
                    { name: 'Ù‚Ù…ÙŠØµ ÙƒØ§Ø¬ÙˆØ§Ù„ Ø£Ù†ÙŠÙ‚', price: 150, quantity: 2, image: 'ğŸ‘”' },
                    { name: 'Ø¨Ù†Ø·Ù„ÙˆÙ† Ø¬ÙŠÙ†Ø² ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ', price: 200, quantity: 1, image: 'ğŸ‘–' }
                ],
                total: 500,
                status: 'pending',
                date: '2024-01-15',
                time: '14:30',
                notes: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 6 Ù…Ø³Ø§Ø¡Ù‹'
            },
            {
                id: 'ORD-002',
                customerName: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ',
                customerPhone: '+966507654321',
                customerAddress: 'Ø¬Ø¯Ø©ØŒ Ø­ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ù„ÙŠØ©',
                items: [
                    { name: 'ÙØ³ØªØ§Ù† ØµÙŠÙÙŠ Ø±Ø§Ù‚ÙŠ', price: 280, quantity: 1, image: 'ğŸ‘—' },
                    { name: 'Ø­Ù‚ÙŠØ¨Ø© ÙŠØ¯ Ø£Ù†ÙŠÙ‚Ø©', price: 180, quantity: 1, image: 'ğŸ‘œ' }
                ],
                total: 460,
                status: 'processing',
                date: '2024-01-15',
                time: '16:45',
                notes: ''
            }
        ];

        // --- Admin protection settings (client-side) ---
        // CHANGE THIS to a stronger password before use. This is client-side only.
        const ADMIN_PASSWORD = 'hicham1972ox';
        // session flag key
        const ADMIN_AUTH_KEY = 'adminAuth';

        function isAuthenticated() {
            try {
                return sessionStorage.getItem(ADMIN_AUTH_KEY) === '1';
            } catch (e) {
                return false;
            }
        }

        function attemptLogin() {
            const input = document.getElementById('adminPasswordInput');
            const err = document.getElementById('loginError');
            if (!input) return;
            if (input.value === ADMIN_PASSWORD) {
                try { sessionStorage.setItem(ADMIN_AUTH_KEY, '1'); } catch (e) {}
                err.classList.add('hidden');
                hideLoginModal();
                // reveal logout button
                try { document.getElementById('logoutBtn').classList.remove('hidden'); } catch (e) {}
                // initialize dashboard after successful login
                initDashboard();
            } else {
                err.classList.remove('hidden');
            }
        }

        function showLoginModal() {
            const m = document.getElementById('loginModal');
            if (m) m.classList.remove('hidden');
        }

        function hideLoginModal() {
            const m = document.getElementById('loginModal');
            if (m) m.classList.add('hidden');
        }

        function logoutAdmin() {
            try { sessionStorage.removeItem(ADMIN_AUTH_KEY); } catch (e) {}
            // reload to reset UI
            location.reload();
        }

        let orders = [];
        let filteredOrders = [];
        let selectedOrderId = null;
        let lastOrderCount = 0;

        // Status translations
        const statusTranslations = {
            'pending': 'Ù…Ø¹Ù„Ù‚',
            'processing': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
            'shipped': 'ØªÙ… Ø§Ù„Ø´Ø­Ù†',
            'delivered': 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…',
            'cancelled': 'Ù…Ù„ØºÙŠ'
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† localStorage
        function loadOrdersFromStorage() {
            const storedOrders = JSON.parse(localStorage.getItem('storeOrders') || '[]');
            // If there are no stored orders, start with an empty list
            // (do not show sample/demo orders). The admin will remain empty
            // until a real order is created and saved to localStorage.
            if (!storedOrders || storedOrders.length === 0) {
                orders = [];
                filteredOrders = [];
                if (orders.length > lastOrderCount && lastOrderCount > 0) {
                    showNewOrderAlert();
                }
                lastOrderCount = orders.length;
                return;
            }

            // Use stored orders only (newest first)
            orders = storedOrders.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateB - dateA;
            });

            filteredOrders = [...orders];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
            if (orders.length > lastOrderCount && lastOrderCount > 0) {
                showNewOrderAlert();
            }
            lastOrderCount = orders.length;
        }

        // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        function showNewOrderAlert() {
            const alert = document.getElementById('newOrderAlert');
            alert.classList.remove('hidden');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 5000);
            
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            playNotificationSound();
        }

        // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        function playNotificationSound() {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
            console.log('ğŸ”” Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØµÙ„!');
        }

        // Initialize the dashboard
        function initDashboard() {
            loadOrdersFromStorage();
            updateStats();
            renderOrders();
            updateLastUpdateTime();
        }

        // Update statistics
        function updateStats() {
            const totalOrders = orders.length;
            const pendingOrders = orders.filter(order => order.status === 'pending').length;
            const totalRevenue = orders.filter(order => order.status !== 'cancelled')
                                       .reduce((sum, order) => sum + order.total, 0);
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(order => order.date === today).length;

            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('totalRevenue').textContent = `${totalRevenue} Ø±ÙŠØ§Ù„`;
            document.getElementById('todayOrders').textContent = todayOrders;
        }

        // Render orders
        function renderOrders() {
            const container = document.getElementById('ordersContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredOrders.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredOrders.map((order, index) => {
                const isNew = index === 0 && orders.length > lastOrderCount;
                return `
                <div class="order-card bg-white rounded-lg shadow-md p-6 fade-in ${isNew ? 'new-order' : ''}">
                    ${isNew ? '<div class="text-green-600 text-sm font-bold mb-2">ğŸ†• Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</div>' : ''}
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-4 space-x-reverse mb-2">
                                <h3 class="text-lg font-bold text-gray-800">${order.id}</h3>
                                <span class="status-badge status-${order.status}">${statusTranslations[order.status]}</span>
                            </div>
                            <div class="text-gray-600 space-y-1">
                                <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${order.customerName}</p>
                                <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.customerPhone}</p>
                                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date} - ${order.time}</p>
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="text-2xl font-bold" style="color: var(--primary-color);">${order.total} Ø±ÙŠØ§Ù„</p>
                            <p class="text-sm text-gray-500">${order.items.length} Ù…Ù†ØªØ¬</p>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                ${order.items.slice(0, 3).map(item => `<span class="text-2xl">${item.image}</span>`).join('')}
                                ${order.items.length > 3 ? `<span class="text-gray-500 text-sm">+${order.items.length - 3}</span>` : ''}
                            </div>
                            <div class="flex space-x-2 space-x-reverse">
                                <button onclick="showOrderDetails('${order.id}')" 
                                        class="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors">
                                    Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                </button>
                                <button onclick="showStatusModal('${order.id}')" 
                                        class="px-4 py-2 text-white btn-primary">
                                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                                </button>
                                <button onclick="deleteOrder('${order.id}')"
                                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                    Ø­Ø°Ù
                                </button>
                                <a href="https://wa.me/${order.customerPhone.replace('+', '')}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ ${order.customerName}ØŒ Ø¨Ø®ØµÙˆØµ Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${order.id}" 
                                   target="_blank" rel="noopener noreferrer"
                                   class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                    ÙˆØ§ØªØ³Ø§Ø¨
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
            
            // Update counters
            document.getElementById('filteredCount').textContent = filteredOrders.length;
            document.getElementById('totalCount').textContent = orders.length;
        }

        // Filter orders
        function filterOrders() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            filteredOrders = orders.filter(order => {
                const matchesSearch = !searchTerm || 
                    order.id.toLowerCase().includes(searchTerm) ||
                    order.customerName.toLowerCase().includes(searchTerm) ||
                    order.customerPhone.includes(searchTerm);
                
                const matchesStatus = !statusFilter || order.status === statusFilter;
                
                const matchesDateFrom = !dateFrom || order.date >= dateFrom;
                const matchesDateTo = !dateTo || order.date <= dateTo;
                
                return matchesSearch && matchesStatus && matchesDateFrom && matchesDateTo;
            });
            
            renderOrders();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            filteredOrders = [...orders];
            renderOrders();
        }

        // Show order details
        function showOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const content = document.getElementById('orderDetailsContent');
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Order Header -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-bold text-lg mb-2">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h4>
                                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${order.id}</p>
                                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date} - ${order.time}</p>
                                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="status-badge status-${order.status}">${statusTranslations[order.status]}</span></p>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg mb-2">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${order.customerName}</p>
                                <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.customerPhone}</p>
                                <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${order.customerAddress}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Items -->
                    <div>
                        <h4 class="font-bold text-lg mb-4">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h4>
                        <div class="space-y-3">
                            ${order.items.map(item => `
                                <div class="flex items-center justify-between border-b pb-3">
                                    <div class="flex items-center">
                                        <span class="text-3xl ml-4">${item.image}</span>
                                        <div>
                                            <h5 class="font-semibold">${item.name}</h5>
                                            <p class="text-gray-600">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}</p>
                                        </div>
                                    </div>
                                    <div class="text-left">
                                        <p class="font-bold">${item.price * item.quantity} Ø±ÙŠØ§Ù„</p>
                                        <p class="text-sm text-gray-500">${item.price} Ø±ÙŠØ§Ù„ Ù„Ù„Ù‚Ø·Ø¹Ø©</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Order Total -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center text-lg font-bold">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                            <span style="color: var(--primary-color);">${order.total} Ø±ÙŠØ§Ù„</span>
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    ${order.notes ? `
                        <div>
                            <h4 class="font-bold text-lg mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4>
                            <p class="bg-yellow-50 p-3 rounded-lg text-gray-700">${order.notes}</p>
                        </div>
                    ` : ''}
                    
                    <!-- Actions -->
                    <div class="flex justify-end space-x-4 space-x-reverse pt-4 border-t">
                        <a href="https://wa.me/${order.customerPhone.replace('+', '')}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ ${order.customerName}ØŒ Ø¨Ø®ØµÙˆØµ Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${order.id}" 
                           target="_blank" rel="noopener noreferrer"
                           class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                        </a>
                        <button onclick="showStatusModal('${order.id}')" 
                                class="px-6 py-2 text-white btn-primary">
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                        </button>
                            <button onclick="deleteOrder('${order.id}')" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨
                            </button>
                    </div>
                </div>
            `;
            
            document.getElementById('orderModal').classList.remove('hidden');
        }

        // Hide order details
        function hideOrderDetails() {
            document.getElementById('orderModal').classList.add('hidden');
        }

        // Show status modal
        function showStatusModal(orderId) {
            selectedOrderId = orderId;
            const order = orders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('newStatus').value = order.status;
            }
            document.getElementById('statusModal').classList.remove('hidden');
        }

        // Hide status modal
        function hideStatusModal() {
            document.getElementById('statusModal').classList.add('hidden');
            selectedOrderId = null;
            document.getElementById('statusForm').reset();
        }

        // Update order status
        function updateOrderStatus(event) {
            event.preventDefault();
            
            if (!selectedOrderId) return;
            
            const newStatus = document.getElementById('newStatus').value;
            const notes = document.getElementById('statusNotes').value;
            
            // Update order in data
            const orderIndex = orders.findIndex(o => o.id === selectedOrderId);
            if (orderIndex !== -1) {
                orders[orderIndex].status = newStatus;
                if (notes) {
                    orders[orderIndex].notes = notes;
                }
            }
            
            // Update filtered orders
            const filteredIndex = filteredOrders.findIndex(o => o.id === selectedOrderId);
            if (filteredIndex !== -1) {
                filteredOrders[filteredIndex].status = newStatus;
                if (notes) {
                    filteredOrders[filteredIndex].notes = notes;
                }
            }
            
            // Update localStorage
            const storedOrders = JSON.parse(localStorage.getItem('storeOrders') || '[]');
            const storedIndex = storedOrders.findIndex(o => o.id === selectedOrderId);
            if (storedIndex !== -1) {
                storedOrders[storedIndex].status = newStatus;
                if (notes) {
                    storedOrders[storedIndex].notes = notes;
                }
                localStorage.setItem('storeOrders', JSON.stringify(storedOrders));
            }
            
            // Refresh UI
            updateStats();
            renderOrders();
            hideStatusModal();
            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ${selectedOrderId} Ø¥Ù„Ù‰ "${statusTranslations[newStatus]}"`);
        }

        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // Refresh orders
        function refreshOrders() {
            loadOrdersFromStorage();
            updateStats();
            renderOrders();
            updateLastUpdateTime();
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Export orders
        function exportOrders() {
            // Ø¥Ù†Ø´Ø§Ø¡ CSV Ø¨Ø³ÙŠØ·
            let csv = 'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨,Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„,Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„ØªØ§Ø±ÙŠØ®\n';
            
            filteredOrders.forEach(order => {
                csv += `${order.id},${order.customerName},${order.customerPhone},${order.total},${statusTranslations[order.status]},${order.date}\n`;
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `orders_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('lastUpdate').textContent = timeString;
        }

        // Delete an order (from UI and localStorage). Also removes from sampleOrders if present.
        function deleteOrder(orderId) {
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ ${orderId}ØŸ`)) return;

            // Remove from runtime arrays
            orders = orders.filter(o => o.id !== orderId);
            filteredOrders = filteredOrders.filter(o => o.id !== orderId);

            // Remove from sampleOrders if present (so demo orders can be removed)
            try {
                sampleOrders = sampleOrders.filter(o => o.id !== orderId);
            } catch (e) {
                console.warn('Could not update sampleOrders:', e);
            }

            // Remove from stored orders in localStorage
            try {
                let stored = JSON.parse(localStorage.getItem('storeOrders') || '[]');
                stored = stored.filter(o => o.id !== orderId);
                localStorage.setItem('storeOrders', JSON.stringify(stored));
            } catch (e) {
                console.error('Failed to remove order from localStorage:', e);
            }

            // Refresh UI and stats
            updateStats();
            renderOrders();
            showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ ${orderId}`);
        }

        // Initialize dashboard when page loads (requires admin auth)
        document.addEventListener('DOMContentLoaded', function() {
            // show logout button if already authenticated
            try {
                const logoutBtn = document.getElementById('logoutBtn');
                if (isAuthenticated() && logoutBtn) logoutBtn.classList.remove('hidden');
            } catch (e) {}

            if (isAuthenticated()) {
                initDashboard();
            } else {
                // block UI until login
                showLoginModal();
            }

            // Auto-refresh every 30 seconds to check for new orders
            setInterval(() => {
                if (isAuthenticated()) refreshOrders();
            }, 30000);

            // Update time every minute
            setInterval(() => { if (isAuthenticated()) updateLastUpdateTime(); }, 60000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98d6bac9c1d2c156',t:'MTc2MDI3MzQ5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>